<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BoredQuest - Pixel Art MMORPG</title>
    <meta name="description" content="Embark on pixelated adventures in BoredQuest, a retro-style MMORPG filled with 8-bit magic, monsters, and treasures." />
    
    <!-- Google Fonts - Pixel Art Style -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P:wght@400&family=VT323:wght@400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              pixel: {
                black: '#0f0f0f',
                dark: '#1a1a1a',
                gray: '#2d2d2d',
                light: '#4a4a4a',
                white: '#ffffff',
                red: '#ff0000',
                green: '#00ff00',
                blue: '#0000ff',
                yellow: '#ffff00',
                purple: '#ff00ff',
                cyan: '#00ffff',
                orange: '#ff8000',
                pink: '#ff0080',
              }
            },
            fontFamily: {
              pixel: ['Press Start 2P', 'monospace'],
              retro: ['VT323', 'monospace'],
            },
            animation: {
              'pixel-bounce': 'pixel-bounce 0.5s ease-in-out',
              'pixel-glow': 'pixel-glow 2s ease-in-out infinite alternate',
              'scanline': 'scanline 2s linear infinite',
              'blink': 'blink 1s infinite',
            },
            keyframes: {
              'pixel-bounce': {
                '0%, 100%': { transform: 'translateY(0px)' },
                '50%': { transform: 'translateY(-4px)' },
              },
              'pixel-glow': {
                '0%': { textShadow: '0 0 4px currentColor' },
                '100%': { textShadow: '0 0 8px currentColor, 0 0 12px currentColor' },
              },
              'scanline': {
                '0%': { transform: 'translateY(-100%)' },
                '100%': { transform: 'translateY(100%)' },
              },
              'blink': {
                '0%, 50%': { opacity: '1' },
                '51%, 100%': { opacity: '0' },
              }
            }
          }
        }
      }
    </script>
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="BoredQuest - Pixel Art MMORPG" />
    <meta property="og:description" content="Embark on pixelated adventures in BoredQuest, a retro-style MMORPG filled with 8-bit magic, monsters, and treasures." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://purgedev-1.github.io/RealmQuest/" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="BoredQuest - Pixel Art MMORPG" />
    <meta name="twitter:description" content="Embark on pixelated adventures in BoredQuest, a retro-style MMORPG filled with 8-bit magic, monsters, and treasures." />
    
    <style>
      /* Pixel Art Styling */
      .pixel-border {
        border: 2px solid #ffffff;
        box-shadow: 
          inset 2px 2px 0px #000000,
          inset -2px -2px 0px #808080;
      }
      
      .pixel-button {
        border: 2px solid #ffffff;
        box-shadow: 
          inset 2px 2px 0px #000000,
          inset -2px -2px 0px #808080;
        background: linear-gradient(45deg, #c0c0c0, #e0e0e0);
        transition: all 0.1s ease;
      }
      
      .pixel-button:hover {
        transform: translateY(-2px);
        box-shadow: 
          inset 1px 1px 0px #000000,
          inset -1px -1px 0px #808080,
          0 4px 0px #000000;
      }
      
      .pixel-button:active {
        transform: translateY(0px);
        box-shadow: 
          inset 2px 2px 0px #000000,
          inset -2px -2px 0px #808080;
      }
      
      .pixel-input {
        border: 2px solid #ffffff;
        box-shadow: 
          inset 2px 2px 0px #000000,
          inset -2px -2px 0px #808080;
        background: #000000;
        color: #00ff00;
        font-family: 'VT323', monospace;
        font-size: 16px;
      }
      
      .pixel-card {
        border: 2px solid #ffffff;
        box-shadow: 
          inset 2px 2px 0px #000000,
          inset -2px -2px 0px #808080;
        background: #1a1a1a;
        position: relative;
      }
      
      .pixel-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(255, 255, 255, 0.03) 2px,
          rgba(255, 255, 255, 0.03) 4px
        );
        pointer-events: none;
      }
      
      .health-bar {
        border: 2px solid #ffffff;
        background: #000000;
        height: 12px;
      }
      
      .health-bar-fill {
        background: linear-gradient(90deg, #ff0000, #ff8000);
        height: 100%;
        transition: width 0.3s ease;
      }
      
      .mana-bar {
        border: 2px solid #ffffff;
        background: #000000;
        height: 12px;
      }
      
      .mana-bar-fill {
        background: linear-gradient(90deg, #0000ff, #0080ff);
        height: 100%;
        transition: width 0.3s ease;
      }
      
      .experience-bar {
        border: 2px solid #ffffff;
        background: #000000;
        height: 6px;
      }
      
      .experience-bar-fill {
        background: linear-gradient(90deg, #ffff00, #ff8000);
        height: 100%;
        transition: width 0.3s ease;
      }
      
      .admin-panel {
        border: 2px solid #ff0000;
        box-shadow: 
          inset 2px 2px 0px #800000,
          inset -2px -2px 0px #ff8080;
        background: #1a0000;
      }
      
      .admin-console {
        border: 2px solid #00ff00;
        background: #000000;
        font-family: 'VT323', monospace;
        font-size: 14px;
        color: #00ff00;
      }
      
      .chat-window {
        border: 2px solid #ffffff;
        background: #000000;
        font-family: 'VT323', monospace;
        font-size: 14px;
        color: #ffffff;
      }
      
      .chat-tab {
        border: 2px solid #ffffff;
        background: #2d2d2d;
        color: #ffffff;
        font-family: 'VT323', monospace;
        font-size: 12px;
        transition: all 0.1s ease;
      }
      
      .chat-tab.active {
        background: #000000;
        border-bottom-color: #000000;
      }
      
      .chat-message {
        margin: 2px 0;
        word-wrap: break-word;
      }
      
      .chat-message.system {
        color: #ffff00;
      }
      
      .chat-message.global {
        color: #00ffff;
      }
      
      .chat-message.local {
        color: #00ff00;
      }
      
      .chat-message.private {
        color: #ff00ff;
      }
      
      .chat-message.admin {
        color: #ff0000;
        font-weight: bold;
      }
      
      .scanline {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: rgba(255, 255, 255, 0.1);
        animation: scanline 2s linear infinite;
        pointer-events: none;
      }
      
      .game-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .game-layout {
        display: grid;
        grid-template-columns: 350px 1fr 350px;
        grid-template-rows: auto 1fr auto;
        gap: 15px;
        height: calc(100vh - 60px);
      }
      
      .game-header {
        grid-column: 1 / -1;
        grid-row: 1;
      }
      
      .game-sidebar-left {
        grid-column: 1;
        grid-row: 2;
      }
      
      .game-main {
        grid-column: 2;
        grid-row: 2;
      }
      
      .game-sidebar-right {
        grid-column: 3;
        grid-row: 2;
      }
      
      .game-footer {
        grid-column: 1 / -1;
        grid-row: 3;
      }
      
      @media (max-width: 1200px) {
        .game-layout {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto 1fr auto auto;
        }
        
        .game-header {
          grid-column: 1;
          grid-row: 1;
        }
        
        .game-sidebar-left {
          grid-column: 1;
          grid-row: 2;
        }
        
        .game-main {
          grid-column: 1;
          grid-row: 3;
        }
        
        .game-sidebar-right {
          grid-column: 1;
          grid-row: 4;
        }
        
        .game-footer {
          grid-column: 1;
          grid-row: 5;
        }
      }
    </style>
  </head>
  <body class="bg-black text-white font-retro overflow-hidden">
    <div class="scanline"></div>
    <div id="app">
      <!-- Home Page -->
      <div id="home-page" class="min-h-screen flex items-center justify-center relative">
        <div class="text-center max-w-4xl mx-auto px-4 z-10">
          <h1 class="text-6xl md:text-8xl font-pixel text-yellow-400 mb-6 animate-pixel-glow">
            BOREDQUEST
          </h1>
          <p class="text-xl md:text-2xl text-green-400 mb-8 font-retro">
            EMBARK ON PIXELATED ADVENTURES IN A RETRO REALM
          </p>
          
          <div class="grid md:grid-cols-3 gap-8 mb-12">
            <div class="pixel-card p-6">
              <h3 class="text-lg font-pixel text-cyan-400 mb-4">REAL-TIME MULTIPLAYER</h3>
              <p class="text-gray-300 font-retro text-lg">PLAY WITH FRIENDS IN PIXELATED COMBAT</p>
            </div>
            
            <div class="pixel-card p-6">
              <h3 class="text-lg font-pixel text-green-400 mb-4">CHARACTER PROGRESSION</h3>
              <p class="text-gray-300 font-retro text-lg">LEVEL UP THROUGH EPIC 8-BIT BATTLES</p>
            </div>
            
            <div class="pixel-card p-6">
              <h3 class="text-lg font-pixel text-purple-400 mb-4">DUNGEON CRAWLING</h3>
              <p class="text-gray-300 font-retro text-lg">EXPLORE PROCEDURALLY GENERATED DUNGEONS</p>
            </div>
          </div>

          <div class="space-x-4">
            <button 
              onclick="showPage('login')"
              class="pixel-button text-black font-pixel py-3 px-6 text-sm"
            >
              LOGIN
            </button>
            <button 
              onclick="showPage('register')"
              class="pixel-button text-black font-pixel py-3 px-6 text-sm"
            >
              REGISTER
            </button>
          </div>
        </div>
      </div>

      <!-- Login Page -->
      <div id="login-page" class="min-h-screen flex items-center justify-center hidden">
        <div class="pixel-card p-8 max-w-md w-full">
          <h2 class="text-2xl font-pixel text-yellow-400 mb-6 text-center">
            LOGIN TO BOREDQUEST
          </h2>
          
          <form onsubmit="handleLogin(event)" class="space-y-6">
            <div>
              <label class="block text-green-400 mb-2 font-retro text-lg">USERNAME</label>
              <input
                type="text"
                id="login-username"
                class="pixel-input w-full px-3 py-2"
                required
              />
            </div>
            
            <div>
              <label class="block text-green-400 mb-2 font-retro text-lg">PASSWORD</label>
              <input
                type="password"
                id="login-password"
                class="pixel-input w-full px-3 py-2"
                required
              />
            </div>
            
            <button
              type="submit"
              class="w-full pixel-button text-black font-pixel py-3"
            >
              LOGIN
            </button>
          </form>
          
          <button 
            onclick="showPage('home')"
            class="w-full mt-6 pixel-button text-black font-pixel py-3"
          >
            BACK TO HOME
          </button>
        </div>
      </div>

      <!-- Register Page -->
      <div id="register-page" class="min-h-screen flex items-center justify-center hidden">
        <div class="pixel-card p-8 max-w-md w-full">
          <h2 class="text-2xl font-pixel text-yellow-400 mb-6 text-center">
            JOIN BOREDQUEST
          </h2>
          
          <form onsubmit="handleRegister(event)" class="space-y-6">
            <div>
              <label class="block text-green-400 mb-2 font-retro text-lg">USERNAME</label>
              <input
                type="text"
                id="register-username"
                class="pixel-input w-full px-3 py-2"
                required
              />
            </div>
            
            <div>
              <label class="block text-green-400 mb-2 font-retro text-lg">PASSWORD</label>
              <input
                type="password"
                id="register-password"
                class="pixel-input w-full px-3 py-2"
                required
              />
            </div>
            
            <button
              type="submit"
              class="w-full pixel-button text-black font-pixel py-3"
            >
              CREATE ACCOUNT
            </button>
          </form>
          
          <button 
            onclick="showPage('home')"
            class="w-full mt-6 pixel-button text-black font-pixel py-3"
          >
            BACK TO HOME
          </button>
        </div>
      </div>

      <!-- Game Page -->
      <div id="game-page" class="h-screen hidden">
        <div class="game-container">
          <div class="game-layout">
            <!-- Header -->
            <div class="game-header">
              <div class="pixel-card p-3">
                <div class="flex justify-between items-center">
                  <h1 class="text-lg font-pixel text-yellow-400">
                    BOREDQUEST
                  </h1>
                  <div class="flex items-center space-x-4">
                    <span id="player-name" class="text-green-400 font-retro text-sm"></span>
                    <span id="admin-badge" class="bg-red-600 text-white px-2 py-1 text-xs font-pixel hidden">ADMIN</span>
                    <button
                      onclick="handleLogout()"
                      class="pixel-button text-black font-pixel py-1 px-3 text-xs"
                    >
                      LOGOUT
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Left Sidebar - Character Info -->
            <div class="game-sidebar-left">
              <div class="pixel-card p-4 mb-4">
                <h3 class="text-base font-pixel text-yellow-400 mb-4">CHARACTER</h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                  <div class="text-center">
                    <p class="text-gray-300 font-retro text-sm">LEVEL</p>
                    <p class="text-2xl font-pixel text-yellow-400" id="player-level">1</p>
                  </div>
                  <div class="text-center">
                    <p class="text-gray-300 font-retro text-sm">GOLD</p>
                    <p class="text-2xl font-pixel text-yellow-400" id="player-gold">100</p>
                  </div>
                </div>
                
                <!-- Health and Mana Bars -->
                <div class="space-y-3">
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-green-400 font-retro">HP</span>
                      <span class="text-green-400 font-retro" id="health-text">100/100</span>
                    </div>
                    <div class="health-bar">
                      <div class="health-bar-fill" id="health-bar" style="width: 100%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-blue-400 font-retro">MP</span>
                      <span class="text-blue-400 font-retro" id="mana-text">50/50</span>
                    </div>
                    <div class="mana-bar">
                      <div class="mana-bar-fill" id="mana-bar" style="width: 100%"></div>
                    </div>
                  </div>
                  
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-yellow-400 font-retro">XP</span>
                      <span class="text-yellow-400 font-retro" id="xp-text">0/100</span>
                    </div>
                    <div class="experience-bar">
                      <div class="experience-bar-fill" id="xp-bar" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Quick Actions -->
              <div class="pixel-card p-4">
                <h3 class="text-base font-pixel text-yellow-400 mb-4">ACTIONS</h3>
                <div class="grid grid-cols-2 gap-3">
                  <button onclick="performAction('attack')" class="pixel-button text-black font-pixel py-3 px-4 text-sm">
                    ATTACK
                  </button>
                  <button onclick="performAction('heal')" class="pixel-button text-black font-pixel py-3 px-4 text-sm">
                    HEAL
                  </button>
                  <button onclick="performAction('magic')" class="pixel-button text-black font-pixel py-3 px-4 text-sm">
                    MAGIC
                  </button>
                  <button onclick="performAction('items')" class="pixel-button text-black font-pixel py-3 px-4 text-sm">
                    ITEMS
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Main Game Area -->
            <div class="game-main">
              <div class="pixel-card p-4 h-full">
                <h3 class="text-base font-pixel text-yellow-400 mb-4">GAME WORLD</h3>
                <div class="bg-black border-2 border-white p-4 h-80 mb-4 overflow-y-auto">
                  <div id="game-log">
                    <p class="text-green-400 font-retro text-base">WELCOME TO BOREDQUEST!</p>
                    <p class="text-gray-300 font-retro text-sm mt-2">YOU ARE IN THE PIXELATED REALM.</p>
                    <p class="text-gray-300 font-retro text-sm">NO ENEMIES NEARBY.</p>
                  </div>
                </div>
                
                <!-- Combat Area -->
                <div id="combat-area" class="hidden">
                  <div class="pixel-card p-4 mb-4">
                    <h4 class="text-sm font-pixel text-red-400 mb-3">COMBAT</h4>
                    <div class="grid grid-cols-2 gap-4">
                      <div>
                        <p class="text-sm font-retro text-green-400 mb-2">YOU</p>
                        <div class="health-bar mb-2">
                          <div class="health-bar-fill" id="player-combat-hp" style="width: 100%"></div>
                        </div>
                        <p class="text-xs text-gray-300" id="player-combat-text">HP: 100/100</p>
                      </div>
                      <div>
                        <p class="text-sm font-retro text-red-400 mb-2" id="enemy-name">ENEMY</p>
                        <div class="health-bar mb-2">
                          <div class="health-bar-fill bg-red-600" id="enemy-hp" style="width: 100%"></div>
                        </div>
                        <p class="text-xs text-gray-300" id="enemy-combat-text">HP: 50/50</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Admin Panel (only visible to admins) -->
                <div id="admin-panel" class="admin-panel p-4 hidden">
                  <h4 class="text-sm font-pixel text-red-400 mb-3">ADMIN PANEL</h4>
                  <div class="grid grid-cols-2 gap-3">
                    <button onclick="adminAction('restart')" class="pixel-button text-black font-pixel py-2 px-3 text-xs">
                      RESTART
                    </button>
                    <button onclick="adminAction('maintenance')" class="pixel-button text-black font-pixel py-2 px-3 text-xs">
                      MAINTENANCE
                    </button>
                    <button onclick="adminAction('backup')" class="pixel-button text-black font-pixel py-2 px-3 text-xs">
                      BACKUP
                    </button>
                    <button onclick="adminAction('ban')" class="pixel-button text-black font-pixel py-2 px-3 text-xs">
                      BAN PLAYER
                    </button>
                  </div>
                  <div class="mt-3">
                    <div class="admin-console p-3">
                      <div id="admin-console" class="h-20 overflow-y-auto text-xs">
                        > Admin console ready...
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Right Sidebar - Chat -->
            <div class="game-sidebar-right">
              <div class="pixel-card p-4 h-full">
                <h3 class="text-base font-pixel text-yellow-400 mb-4">CHAT</h3>
                
                <!-- Chat Tabs -->
                <div class="flex mb-3">
                  <button onclick="switchChatTab('global')" class="chat-tab active px-3 py-2 text-sm">
                    GLOBAL
                  </button>
                  <button onclick="switchChatTab('local')" class="chat-tab px-3 py-2 text-sm">
                    LOCAL
                  </button>
                  <button onclick="switchChatTab('private')" class="chat-tab px-3 py-2 text-sm">
                    PRIVATE
                  </button>
                </div>
                
                <!-- Chat Window -->
                <div class="chat-window p-3 mb-3 h-64 overflow-y-auto">
                  <div id="chat-messages">
                    <div class="chat-message system">[SYSTEM] Welcome to BoredQuest!</div>
                    <div class="chat-message global">[GLOBAL] Player1: Hello everyone!</div>
                    <div class="chat-message local">[LOCAL] Player2: Anyone want to team up?</div>
                  </div>
                </div>
                
                <!-- Chat Input -->
                <div class="flex mb-4">
                  <input
                    type="text"
                    id="chat-input"
                    class="pixel-input flex-1 px-3 py-2 text-sm"
                    placeholder="Type your message..."
                    maxlength="100"
                  />
                  <button
                    onclick="sendChatMessage()"
                    class="pixel-button text-black font-pixel py-2 px-3 text-sm ml-2"
                  >
                    SEND
                  </button>
                </div>
                
                <!-- Online Players -->
                <div>
                  <h4 class="text-sm font-pixel text-yellow-400 mb-3">ONLINE (3)</h4>
                  <div class="text-sm text-gray-300 space-y-2">
                    <div class="flex justify-between">
                      <span>Player1</span>
                      <span class="text-green-400">●</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Player2</span>
                      <span class="text-green-400">●</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Player3</span>
                      <span class="text-green-400">●</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Footer -->
            <div class="game-footer">
              <div class="pixel-card p-2">
                <div class="flex justify-between items-center text-xs">
                  <span class="text-gray-300">STATUS: ONLINE</span>
                  <span class="text-gray-300">PLAYERS: 3</span>
                  <span class="text-gray-300">UPTIME: 2h 15m</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Game State
      let currentUser = null;
      let isAdmin = false;
      let maintenanceMode = false;
      let accounts = [];
      let isFirstAccount = true;
      let currentChatTab = 'global';
      let chatMessages = {
        global: [
          { type: 'system', text: 'Welcome to BoredQuest!' },
          { type: 'global', user: 'Player1', text: 'Hello everyone!' },
          { type: 'local', user: 'Player2', text: 'Anyone want to team up?' }
        ],
        local: [
          { type: 'system', text: 'Local chat - only visible to nearby players' },
          { type: 'local', user: 'Player2', text: 'Anyone want to team up?' }
        ],
        private: [
          { type: 'system', text: 'Private messages will appear here' }
        ]
      };

      // Player Data Structure
      let playerData = {
        level: 1,
        health: 100,
        maxHealth: 100,
        mana: 50,
        maxMana: 50,
        experience: 0,
        experienceToNext: 100,
        gold: 100,
        inventory: [],
        equipment: {}
      };

      // Combat State
      let inCombat = false;
      let currentEnemy = null;
      let enemyTypes = [
        { name: 'Goblin', health: 30, maxHealth: 30, damage: 5, exp: 20, gold: 15 },
        { name: 'Orc', health: 50, maxHealth: 50, damage: 8, exp: 35, gold: 25 },
        { name: 'Troll', health: 80, maxHealth: 80, damage: 12, exp: 60, gold: 40 },
        { name: 'Dragon', health: 150, maxHealth: 150, damage: 20, exp: 100, gold: 75 }
      ];

      // GitHub Storage Configuration
      const GITHUB_CONFIG = {
        owner: 'purgedev-1',
        repo: 'RealmQuest',
        branch: 'main',
        dataPath: 'data/',
        token: null // Will be set by user
      };

      // Encryption key (in production, this would be more secure)
      const ENCRYPTION_KEY = 'boredquest-secure-key-2024';

      // Simple encryption/decryption functions
      function encryptData(data) {
        const jsonString = JSON.stringify(data);
        const encoded = btoa(jsonString);
        return encoded;
      }

      function decryptData(encryptedData) {
        try {
          const decoded = atob(encryptedData);
          return JSON.parse(decoded);
        } catch (error) {
          console.error('Failed to decrypt data:', error);
          return null;
        }
      }

      // GitHub API functions
      async function saveToGitHub(filename, data) {
        if (!GITHUB_CONFIG.token) {
          console.warn('No GitHub token set, falling back to localStorage');
          localStorage.setItem(`boredquest_${filename}`, JSON.stringify(data));
          return false;
        }

        try {
          const encryptedData = encryptData(data);
          const content = btoa(encryptedData);
          
          // Check if file exists
          const existingFile = await getGitHubFile(filename);
          
          const requestBody = {
            message: `Update ${filename} - ${new Date().toISOString()}`,
            content: content,
            branch: GITHUB_CONFIG.branch
          };

          if (existingFile) {
            requestBody.sha = existingFile.sha;
          }

          const response = await fetch(
            `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataPath}${filename}.json`,
            {
              method: 'PUT',
              headers: {
                'Authorization': `token ${GITHUB_CONFIG.token}`,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestBody)
            }
          );

          if (response.ok) {
            console.log(`Successfully saved ${filename} to GitHub`);
            return true;
          } else {
            console.error(`Failed to save ${filename} to GitHub:`, await response.text());
            return false;
          }
        } catch (error) {
          console.error(`Error saving ${filename} to GitHub:`, error);
          return false;
        }
      }

      async function loadFromGitHub(filename) {
        if (!GITHUB_CONFIG.token) {
          console.warn('No GitHub token set, loading from localStorage');
          const localData = localStorage.getItem(`boredquest_${filename}`);
          return localData ? JSON.parse(localData) : null;
        }

        try {
          const file = await getGitHubFile(filename);
          if (file) {
            const encryptedData = atob(file.content);
            const decryptedData = decryptData(encryptedData);
            console.log(`Successfully loaded ${filename} from GitHub`);
            return decryptedData;
          }
        } catch (error) {
          console.error(`Error loading ${filename} from GitHub:`, error);
        }
        return null;
      }

      async function getGitHubFile(filename) {
        try {
          const response = await fetch(
            `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dataPath}${filename}.json`,
            {
              headers: {
                'Authorization': `token ${GITHUB_CONFIG.token}`,
              }
            }
          );

          if (response.ok) {
            return await response.json();
          } else if (response.status === 404) {
            return null; // File doesn't exist
          } else {
            console.error(`Failed to get ${filename} from GitHub:`, await response.text());
            return null;
          }
        } catch (error) {
          console.error(`Error getting ${filename} from GitHub:`, error);
          return null;
        }
      }

      // Load data from GitHub/localStorage
      async function loadGameData() {
        try {
          // Load accounts
          const savedAccounts = await loadFromGitHub('accounts');
          if (savedAccounts) {
            accounts = savedAccounts;
          }

          // Load first account flag
          const savedFirstAccount = await loadFromGitHub('first_account');
          if (savedFirstAccount !== null) {
            isFirstAccount = savedFirstAccount;
          }

          console.log('Game data loaded successfully');
        } catch (error) {
          console.error('Error loading game data:', error);
        }
      }

      // Save data to GitHub/localStorage
      async function saveGameData() {
        try {
          await saveToGitHub('accounts', accounts);
          await saveToGitHub('first_account', isFirstAccount);
          console.log('Game data saved successfully');
        } catch (error) {
          console.error('Error saving game data:', error);
        }
      }

      // Save player data for specific user
      async function savePlayerData(username, data) {
        try {
          await saveToGitHub(`player_${username}`, data);
          console.log(`Player data saved for ${username}`);
        } catch (error) {
          console.error(`Error saving player data for ${username}:`, error);
        }
      }

      // Load player data for specific user
      async function loadPlayerData(username) {
        try {
          const data = await loadFromGitHub(`player_${username}`);
          return data;
        } catch (error) {
          console.error(`Error loading player data for ${username}:`, error);
          return null;
        }
      }

      // GitHub token setup
      function setupGitHubToken() {
        const token = prompt('Enter your GitHub Personal Access Token (optional):\n\nTo enable cloud save:\n1. Go to GitHub Settings > Developer settings > Personal access tokens\n2. Generate a new token with "repo" permissions\n3. Paste it here\n\nLeave empty to use local storage only.');
        
        if (token && token.trim()) {
          GITHUB_CONFIG.token = token.trim();
          localStorage.setItem('boredquest_github_token', token.trim());
          addGameLog('GitHub cloud save enabled!', 'text-green-400');
          addChatMessage('system', 'Cloud save enabled - your progress will be saved across all devices!');
        } else {
          GITHUB_CONFIG.token = null;
          localStorage.removeItem('boredquest_github_token');
          addGameLog('Using local storage only', 'text-yellow-400');
        }
      }

      // Load saved GitHub token
      function loadGitHubToken() {
        const savedToken = localStorage.getItem('boredquest_github_token');
        if (savedToken) {
          GITHUB_CONFIG.token = savedToken;
        }
      }

      // Update UI with current player data
      function updatePlayerUI() {
        document.getElementById('player-level').textContent = playerData.level;
        document.getElementById('player-gold').textContent = playerData.gold;
        document.getElementById('health-text').textContent = `${playerData.health}/${playerData.maxHealth}`;
        document.getElementById('mana-text').textContent = `${playerData.mana}/${playerData.maxMana}`;
        document.getElementById('xp-text').textContent = `${playerData.experience}/${playerData.experienceToNext}`;
        
        // Update health bar
        const healthPercent = (playerData.health / playerData.maxHealth) * 100;
        document.getElementById('health-bar').style.width = `${healthPercent}%`;
        
        // Update mana bar
        const manaPercent = (playerData.mana / playerData.maxMana) * 100;
        document.getElementById('mana-bar').style.width = `${manaPercent}%`;
        
        // Update XP bar
        const xpPercent = (playerData.experience / playerData.experienceToNext) * 100;
        document.getElementById('xp-bar').style.width = `${xpPercent}%`;
      }

      // Add message to game log
      function addGameLog(message, color = 'text-gray-300') {
        const gameLog = document.getElementById('game-log');
        const messageDiv = document.createElement('p');
        messageDiv.className = `font-retro text-sm mt-1 ${color}`;
        messageDiv.textContent = message;
        gameLog.appendChild(messageDiv);
        gameLog.scrollTop = gameLog.scrollHeight;
        
        // Keep only last 20 messages
        while (gameLog.children.length > 20) {
          gameLog.removeChild(gameLog.firstChild);
        }
      }

      // Spawn enemy
      function spawnEnemy() {
        if (inCombat) return;
        
        const enemyType = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
        currentEnemy = {
          ...enemyType,
          health: enemyType.maxHealth
        };
        
        inCombat = true;
        document.getElementById('combat-area').classList.remove('hidden');
        document.getElementById('enemy-name').textContent = currentEnemy.name;
        document.getElementById('enemy-hp').style.width = '100%';
        document.getElementById('enemy-combat-text').textContent = `HP: ${currentEnemy.health}/${currentEnemy.maxHealth}`;
        
        addGameLog(`A ${currentEnemy.name} appears!`, 'text-red-400');
        addChatMessage('system', `A ${currentEnemy.name} has appeared!`);
      }

      // Combat mechanics
      function performAction(action) {
        if (!inCombat && action !== 'heal') {
          spawnEnemy();
          return;
        }
        
        if (!inCombat && action === 'heal') {
          healPlayer();
          return;
        }
        
        switch(action) {
          case 'attack':
            attackEnemy();
            break;
          case 'heal':
            healPlayer();
            break;
          case 'magic':
            castMagic();
            break;
          case 'items':
            useItem();
            break;
        }
      }

      function attackEnemy() {
        if (!inCombat || !currentEnemy) return;
        
        const damage = Math.floor(Math.random() * 10) + 5; // 5-15 damage
        currentEnemy.health -= damage;
        
        addGameLog(`You attack the ${currentEnemy.name} for ${damage} damage!`, 'text-green-400');
        
        // Update enemy health bar
        const enemyHealthPercent = (currentEnemy.health / currentEnemy.maxHealth) * 100;
        document.getElementById('enemy-hp').style.width = `${enemyHealthPercent}%`;
        document.getElementById('enemy-combat-text').textContent = `HP: ${currentEnemy.health}/${currentEnemy.maxHealth}`;
        
        // Check if enemy is defeated
        if (currentEnemy.health <= 0) {
          defeatEnemy();
        } else {
          // Enemy counter-attack
          setTimeout(() => enemyAttack(), 1000);
        }
      }

      function enemyAttack() {
        if (!inCombat || !currentEnemy) return;
        
        const damage = Math.floor(Math.random() * currentEnemy.damage) + 1;
        playerData.health -= damage;
        
        addGameLog(`The ${currentEnemy.name} attacks you for ${damage} damage!`, 'text-red-400');
        
        // Update player health bar
        const healthPercent = (playerData.health / playerData.maxHealth) * 100;
        document.getElementById('health-bar').style.width = `${healthPercent}%`;
        document.getElementById('player-combat-hp').style.width = `${healthPercent}%`;
        document.getElementById('health-text').textContent = `${playerData.health}/${playerData.maxHealth}`;
        document.getElementById('player-combat-text').textContent = `HP: ${playerData.health}/${playerData.maxHealth}`;
        
        updatePlayerUI();
        
        // Check if player is defeated
        if (playerData.health <= 0) {
          playerDefeated();
        }
      }

      function defeatEnemy() {
        addGameLog(`You defeated the ${currentEnemy.name}!`, 'text-yellow-400');
        addGameLog(`Gained ${currentEnemy.exp} experience and ${currentEnemy.gold} gold!`, 'text-yellow-400');
        
        // Award experience and gold
        playerData.experience += currentEnemy.exp;
        playerData.gold += currentEnemy.gold;
        
        // Check for level up
        if (playerData.experience >= playerData.experienceToNext) {
          levelUp();
        }
        
        // End combat
        inCombat = false;
        currentEnemy = null;
        document.getElementById('combat-area').classList.add('hidden');
        
        updatePlayerUI();
        savePlayerData(currentUser, playerData);
        
        // Spawn new enemy after delay
        setTimeout(() => {
          if (Math.random() < 0.3) { // 30% chance to spawn new enemy
            spawnEnemy();
          }
        }, 3000);
      }

      function levelUp() {
        playerData.level++;
        playerData.experience -= playerData.experienceToNext;
        playerData.experienceToNext = Math.floor(playerData.experienceToNext * 1.5);
        playerData.maxHealth += 20;
        playerData.maxMana += 10;
        playerData.health = playerData.maxHealth;
        playerData.mana = playerData.maxMana;
        
        addGameLog(`LEVEL UP! You are now level ${playerData.level}!`, 'text-yellow-400');
        addGameLog(`Health increased to ${playerData.maxHealth}!`, 'text-green-400');
        addChatMessage('system', `${currentUser} reached level ${playerData.level}!`);
      }

      function healPlayer() {
        if (playerData.mana < 10) {
          addGameLog('Not enough mana to heal!', 'text-red-400');
          return;
        }
        
        const healAmount = 30;
        const oldHealth = playerData.health;
        playerData.health = Math.min(playerData.maxHealth, playerData.health + healAmount);
        playerData.mana -= 10;
        
        const actualHeal = playerData.health - oldHealth;
        addGameLog(`You heal yourself for ${actualHeal} health!`, 'text-green-400');
        
        updatePlayerUI();
        savePlayerData(currentUser, playerData);
      }

      function castMagic() {
        if (playerData.mana < 15) {
          addGameLog('Not enough mana to cast magic!', 'text-red-400');
          return;
        }
        
        if (!inCombat || !currentEnemy) {
          addGameLog('No enemy to cast magic on!', 'text-red-400');
          return;
        }
        
        const damage = Math.floor(Math.random() * 20) + 15; // 15-35 damage
        currentEnemy.health -= damage;
        playerData.mana -= 15;
        
        addGameLog(`You cast a powerful spell for ${damage} damage!`, 'text-blue-400');
        
        // Update enemy health bar
        const enemyHealthPercent = (currentEnemy.health / currentEnemy.maxHealth) * 100;
        document.getElementById('enemy-hp').style.width = `${enemyHealthPercent}%`;
        document.getElementById('enemy-combat-text').textContent = `HP: ${currentEnemy.health}/${currentEnemy.maxHealth}`;
        
        updatePlayerUI();
        
        // Check if enemy is defeated
        if (currentEnemy.health <= 0) {
          defeatEnemy();
        } else {
          // Enemy counter-attack
          setTimeout(() => enemyAttack(), 1000);
        }
      }

      function useItem() {
        addGameLog('No items available yet!', 'text-gray-400');
      }

      function playerDefeated() {
        addGameLog('You have been defeated!', 'text-red-400');
        addGameLog('Respawning in 5 seconds...', 'text-yellow-400');
        
        // Reset player health and mana
        playerData.health = playerData.maxHealth;
        playerData.mana = playerData.maxMana;
        
        // End combat
        inCombat = false;
        currentEnemy = null;
        document.getElementById('combat-area').classList.add('hidden');
        
        updatePlayerUI();
        savePlayerData(currentUser, playerData);
        
        setTimeout(() => {
          addGameLog('You have respawned!', 'text-green-400');
        }, 5000);
      }

      function showPage(pageName) {
        // Hide all pages
        document.getElementById('home-page').classList.add('hidden');
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('register-page').classList.add('hidden');
        document.getElementById('game-page').classList.add('hidden');
        
        // Show the requested page
        document.getElementById(pageName + '-page').classList.remove('hidden');
      }

      async function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('login-username').value;
        const password = document.getElementById('login-password').value;
        
        if (username && password) {
          // Check if account exists
          const account = accounts.find(acc => acc.username === username && acc.password === password);
          
          if (account) {
            isAdmin = account.isAdmin;
            currentUser = username;
            
            // Load player data for this user
            const userData = await loadPlayerData(username);
            if (userData) {
              playerData = userData;
            }
            
            document.getElementById('player-name').textContent = username;
            updatePlayerUI();
            
            if (isAdmin) {
              document.getElementById('admin-badge').classList.remove('hidden');
              document.getElementById('admin-panel').classList.remove('hidden');
              logToAdminConsole('Admin login successful');
              addChatMessage('system', `Admin ${username} has logged in!`);
            } else {
              document.getElementById('admin-badge').classList.add('hidden');
              document.getElementById('admin-panel').classList.add('hidden');
            }
            showPage('game');
            addChatMessage('system', `${username} has joined the game!`);
            addGameLog(`Welcome back, ${username}!`, 'text-green-400');
          } else {
            alert('INVALID USERNAME OR PASSWORD!');
          }
        }
      }

      async function handleRegister(event) {
        event.preventDefault();
        const username = document.getElementById('register-username').value;
        const password = document.getElementById('register-password').value;
        
        if (username && password) {
          // Check if username already exists
          const existingAccount = accounts.find(acc => acc.username === username);
          
          if (existingAccount) {
            alert('USERNAME ALREADY EXISTS! PLEASE CHOOSE A DIFFERENT USERNAME.');
            return;
          }
          
          // Create new account
          const newAccount = {
            username: username,
            password: password,
            isAdmin: isFirstAccount // First account becomes admin
          };
          
          accounts.push(newAccount);
          
          isAdmin = isFirstAccount;
          currentUser = username;
          document.getElementById('player-name').textContent = username;
          
          // Initialize player data for new user
          playerData = {
            level: 1,
            health: 100,
            maxHealth: 100,
            mana: 50,
            maxMana: 50,
            experience: 0,
            experienceToNext: 100,
            gold: 100,
            inventory: [],
            equipment: {}
          };
          
          if (isFirstAccount) {
            document.getElementById('admin-badge').classList.remove('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            logToAdminConsole('First account created - Admin privileges granted');
            addChatMessage('system', `🎉 ${username} is the first player and has been granted admin privileges!`);
            alert('🎉 CONGRATULATIONS! YOU ARE THE FIRST PLAYER AND HAVE BEEN GRANTED ADMIN PRIVILEGES!');
            isFirstAccount = false;
          } else {
            document.getElementById('admin-badge').classList.add('hidden');
            document.getElementById('admin-panel').classList.add('hidden');
          }
          
          updatePlayerUI();
          await saveGameData();
          await savePlayerData(username, playerData);
          showPage('game');
          addChatMessage('system', `${username} has joined BoredQuest!`);
          addGameLog(`Welcome to BoredQuest, ${username}!`, 'text-green-400');
        }
      }

      async function handleLogout() {
        if (currentUser) {
          // Save player data for this user
          await savePlayerData(currentUser, playerData);
          addChatMessage('system', `${currentUser} has left the game.`);
        }
        currentUser = null;
        isAdmin = false;
        document.getElementById('login-username').value = '';
        document.getElementById('login-password').value = '';
        document.getElementById('register-username').value = '';
        document.getElementById('register-password').value = '';
        showPage('home');
      }

      function adminAction(action) {
        if (!isAdmin) return;
        
        const timestamp = new Date().toLocaleTimeString();
        
        switch(action) {
          case 'restart':
            logToAdminConsole(`[${timestamp}] Server restart initiated...`);
            addChatMessage('system', 'Server restart initiated by admin...');
            setTimeout(() => {
              logToAdminConsole(`[${timestamp}] Server restart completed successfully`);
              addChatMessage('system', 'Server restart completed successfully');
            }, 2000);
            break;
          case 'maintenance':
            maintenanceMode = !maintenanceMode;
            logToAdminConsole(`[${timestamp}] Maintenance mode ${maintenanceMode ? 'enabled' : 'disabled'}`);
            addChatMessage('system', `Maintenance mode ${maintenanceMode ? 'enabled' : 'disabled'} by admin`);
            break;
          case 'backup':
            logToAdminConsole(`[${timestamp}] Creating server backup...`);
            addChatMessage('system', 'Creating server backup...');
            setTimeout(() => {
              logToAdminConsole(`[${timestamp}] Backup completed: boredquest_backup_${Date.now()}.zip`);
              addChatMessage('system', `Backup completed: boredquest_backup_${Date.now()}.zip`);
            }, 1500);
            break;
          case 'ban':
            const playerToBan = prompt('Enter player name to ban:');
            if (playerToBan) {
              logToAdminConsole(`[${timestamp}] Player '${playerToBan}' has been banned`);
              addChatMessage('system', `Player '${playerToBan}' has been banned by admin`);
            }
            break;
        }
      }

      function logToAdminConsole(message) {
        const console = document.getElementById('admin-console');
        console.innerHTML += '<br>' + message;
        console.scrollTop = console.scrollHeight;
      }

      function switchChatTab(tab) {
        currentChatTab = tab;
        
        // Update tab styling
        document.querySelectorAll('.chat-tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        
        // Update chat messages
        updateChatDisplay();
      }

      function updateChatDisplay() {
        const chatContainer = document.getElementById('chat-messages');
        chatContainer.innerHTML = '';
        
        chatMessages[currentChatTab].forEach(msg => {
          const messageDiv = document.createElement('div');
          messageDiv.className = `chat-message ${msg.type}`;
          
          if (msg.user) {
            messageDiv.textContent = `[${currentChatTab.toUpperCase()}] ${msg.user}: ${msg.text}`;
          } else {
            messageDiv.textContent = `[${msg.type.toUpperCase()}] ${msg.text}`;
          }
          
          chatContainer.appendChild(messageDiv);
        });
        
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function addChatMessage(type, text, user = null) {
        const message = { type, text, user };
        chatMessages[currentChatTab].push(message);
        
        // Keep only last 50 messages
        if (chatMessages[currentChatTab].length > 50) {
          chatMessages[currentChatTab].shift();
        }
        
        updateChatDisplay();
      }

      function sendChatMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        
        if (message && currentUser) {
          addChatMessage(currentChatTab, message, currentUser);
          input.value = '';
        }
      }

      // Auto-save player data every 30 seconds
      setInterval(async () => {
        if (currentUser) {
          await savePlayerData(currentUser, playerData);
        }
      }, 30000);

      // Handle Enter key in chat input
      document.addEventListener('DOMContentLoaded', async function() {
        loadGitHubToken();
        await loadGameData();
        
        // Show GitHub token setup on first visit
        if (!GITHUB_CONFIG.token) {
          setTimeout(() => {
            setupGitHubToken();
          }, 2000);
        }
        
        const chatInput = document.getElementById('chat-input');
        if (chatInput) {
          chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              sendChatMessage();
            }
          });
        }
      });

      // Show home page by default
      showPage('home');
    </script>
  </body>
</html> 